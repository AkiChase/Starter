import{_ as B,W as c,X as r,Y as n,Z as s,$ as a,a1 as o,a0 as l,C as t}from"./framework-c8ebc670.js";const i="/Starter/assets/plugin-mode-10-b9a0a493.jpg",y="/Starter/assets/plugin-mode-11-56f068a0.jpg",F={},d=l('<p>在理解<strong>插件模式</strong>的基本应用之后，可以尝试进阶应用。</p><h2 id="动态获取数据" tabindex="-1"><a class="header-anchor" href="#动态获取数据" aria-hidden="true">#</a> 动态获取数据</h2><p>动态获取数据一般是在 <code>searchHandler</code> 运行时，动态地从数据来源获取数据，然后将其添加、显示在列表中。</p><p>这个数据来源可以是<strong>网络</strong>、<strong>其他程序</strong>等等，只要包含了你需要列举的数据，都可以作为数据来源。</p>',4),A=n("code",null,"searchHandler",-1),v=l(`<div class="language-ahk line-numbers-mode" data-ext="ahk"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">searchHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 如果有搜索内容        </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 进行网络请求，获取当前searchText的搜索联想词</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">outer</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">request</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">lxUrl</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">UrlEncode</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 重置搜索结果数据</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 对网络请求结果进行解析、转换</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">globalMatch</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;\\&lt;suggestion data=&quot;(.*?)&quot;\\/\\&gt;&#39;</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 有联想词</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 提前对搜索结果数组进行扩容</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Capacity</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;"> + </span><span style="color:#D19A66;">1</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 添加至搜索结果数组</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">item</span><span style="color:#ABB2BF;"> in </span><span style="color:#E06C75;">res</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Push</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">item</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 如果联想词中不包括当前搜索内容，则把当前搜索内容插入在第一位</span></span>
<span class="line"><span style="color:#ABB2BF;">            (</span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Has</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&amp;&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">InsertAt</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">; 无联想词，仅插入当前搜索内容</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Push</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">; 搜索内容为空时什么都不显示</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">;重置列表</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Opt</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-Redraw&quot;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;">;禁用重绘</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Delete</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; 添加搜索结果到列表</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">item</span><span style="color:#ABB2BF;"> in </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Add</span><span style="color:#ABB2BF;">(, </span><span style="color:#E06C75;">item</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">resizeGui</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">;根据搜索结果数量调整gui尺寸 并启用重绘</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如此就实现了<strong>网页搜索</strong>插件中的联想词效果。</p><h2 id="图标相关" tabindex="-1"><a class="header-anchor" href="#图标相关" aria-hidden="true">#</a> 图标相关</h2><h3 id="相关概念" tabindex="-1"><a class="header-anchor" href="#相关概念" aria-hidden="true">#</a> 相关概念</h3><p><code>listView</code> 是可以使用图标的，在插件模式中当然也可以为每个列表项添加图标。</p><p>不过需要首先了解一下 <code>PluginMode</code> 模块的几个成员。</p><ul><li><code>that.imgPathToImgListIndex</code></li></ul>`,7),u=n("code",null,"imgPathToImgListIndex",-1),E=n("code",null,"Map",-1),C=n("strong",null,"图片路径关键字",-1),m={href:"https://orz707.gitee.io/v2/docs/commands/ListView.htm",target:"_blank",rel:"noopener noreferrer"},h=n("code",null,"listView",-1),b=n("ul",null,[n("li",null,[n("code",null,"that.imgListID")])],-1),g=n("code",null,"listView",-1),f=n("code",null,"ImageList",-1),D=n("code",null,"ImageList",-1),_={href:"https://orz707.gitee.io/v2/docs/commands/ListView.htm#IL_Add",target:"_blank",rel:"noopener noreferrer"},x=l('<ul><li><code>that.reloadLVIL(ILFlag)</code></li></ul><p><code>reloadLVIL(ILFlag)</code> 方法将清空 <code>listView</code> ，</p><p>若 <code>ILFlag</code> 为真，还会重置 <code>imgPathToImgListIndex</code>，销毁旧的 <code>ImageList</code>，创建新 <code>ImageList</code> 并绑定到 <code>listView</code> 上</p><p>简言之，<strong>重置列表和图标资源</strong>。</p><h3 id="简易文件夹示例-plus" tabindex="-1"><a class="header-anchor" href="#简易文件夹示例-plus" aria-hidden="true">#</a> 简易文件夹示例 Plus</h3>',5),I=l(`<div class="language-ahk line-numbers-mode" data-ext="ahk"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">static</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">showPluginMode</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; 构造文件夹相关数据</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">searchData</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; PluginHelper.imgDir 为Starter存放图片资源的目录</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">loop files</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgDir</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;\\*.*&quot;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">searchData</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Push</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">title</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">A_LoopFileName</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">keywords</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">chineseFirstChar</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">A_LoopFileName</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">path</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">A_LoopFileFullPath</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; 此处that指的是 pluginMode 模块，即插件模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">searchHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 如果有搜索内容则进行匹配</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">StrLen</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> [] </span><span style="color:#7F848E;font-style:italic;">; 重置 pluginSearchResult</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> in </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchData</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 如果搜索内容是title或者keywords的一部分则添加到搜索结果</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">InStr</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">||</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">InStr</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">keywords</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Push</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">; 否则显示全部</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">;重置列表</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Opt</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-Redraw&quot;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;">;禁用重绘</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Delete</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> in </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">SplitPath</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, , , &amp;</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 实际操作时建议在数据加载阶段就把ext计算并储存，避免在此重复计算ext的值</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;ico&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; ico文件使用全路径作为imgPath</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Add</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;icon&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgPathToImgListIndex</span><span style="color:#ABB2BF;">[</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">], </span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 其他文件使用后缀作为imgPath</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Add</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;icon&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgPathToImgListIndex</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;">], </span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 调整gui尺寸 并启用重绘</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">resizeGui</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">runHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">rowNum</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 通过pluginSearchResult和当前启动的行号访问到当前数据</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">curData</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchResult</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">rowNum</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 此处的this指的是当前插件，不要和that混淆</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">hideSearchGui</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">; 隐藏搜索框</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">tip</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;在文件夹中显示:</span><span style="color:#56B6C2;">\`n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">curData</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">openFileInFolder</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">curData</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">; 在文件夹中显示当前文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; 定义预加载图标处理函数</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; 该函数会在进入插件模式和reloadLVIL(true)时被执行</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">loadImgsHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> in </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginSearchData</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">SplitPath</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">, , , &amp;</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;ico&#39;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 由于ico图片资源的图标是不同的，每个都要加载</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 所以使用文件全路径作为imgPath</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 而作为图标的资源文件自然就是ico文件本身</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgPathToImgListIndex</span><span style="color:#ABB2BF;">[</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">IL_Add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgListID</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 此处仅仅是示例，实际上还需要考虑到图标是否会加载失败即 IL_Add 返回 0</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 失败则应当使用一个默认图标，避免出现空白</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 而其他文件类型比如png图片资源的图标使用相同的，不重复加载</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 所以使用文件后缀作为imgPath</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">; 我们可以通过工具函数获取指定文件路径关联的图标的hIcon</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgPathToImgListIndex</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Has</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E06C75;">hIcon</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">associatedHIcon</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">path</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgPathToImgListIndex</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">ext</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">IL_Add</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">imgListID</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;HICON:*&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">hIcon</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    </span><span style="color:#7F848E;font-style:italic;">; 和ico中一样，实际操作时应当加载失败的判断</span></span>
<span class="line"><span style="color:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">showPluginMode</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">searchData</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">searchHandler</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">runHandler</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">loadImgsHandler</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">loadImgsHandler</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">thumb</span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getPluginHIcon</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">; 搜索框图标</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    )</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果如图：</p><p><img src="`+i+'" alt="带图标的简易文件夹:全部" loading="lazy"></p><p><img src="'+y+'" alt="带图标的简易文件夹:ico" loading="lazy"></p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果有动态获取数据或者异步加载数据的情况下，可能会出现图标无法提前全部预加载的情况</p><p>那么就要把图标加载也放在<code>searchHandler</code>中，在<strong>获取新数据后</strong>根据情况进行图标加载</p></div><h2 id="粘贴非文本内容、拖入文件" tabindex="-1"><a class="header-anchor" href="#粘贴非文本内容、拖入文件" aria-hidden="true">#</a> 粘贴非文本内容、拖入文件</h2>',6),L=n("code",null,"pasteContentHandler",-1),P=n("code",null,"dropFilesHandler",-1),S=l(`<div class="language-ahk line-numbers-mode" data-ext="ahk"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">; 粘贴文件/位图处理函数</span></span>
<span class="line"><span style="color:#61AFEF;">pasteContentHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">typeName</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">content</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">typeName</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;file&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">;非文件类型都不允许</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#C678DD;">IsSet</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">A_Clipboard</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">InStr</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\`r\`n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;">; 不允许多文件</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">InStr</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">FileExist</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">), </span><span style="color:#98C379;">&quot;D&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">;仅允许单文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> { </span><span style="color:#7F848E;font-style:italic;">;粘贴完成后的触发</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">placeholder</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;在文件夹内搜索&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">searchText</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">; 直接触发搜索</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setSearchTextSel</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">StrLen</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;">; 游标移动到最后</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-ahk line-numbers-mode" data-ext="ahk"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">; 拖入文件处理函数</span></span>
<span class="line"><span style="color:#61AFEF;">dropFilesHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">fileList</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">pre</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">pre</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">fileList</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Length</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">InStr</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">FileExist</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">fileList</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]), </span><span style="color:#98C379;">&quot;D&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">;仅允许单文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> { </span><span style="color:#7F848E;font-style:italic;">;拖入生效后的触发</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">placeholder</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;在文件夹内搜索&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">searchText</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">searchText</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">:=</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;">; 直接触发搜索</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setSearchTextSel</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">StrLen</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;">)) </span><span style="color:#7F848E;font-style:italic;">; 游标移动到最后</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="触底回调" tabindex="-1"><a class="header-anchor" href="#触底回调" aria-hidden="true">#</a> 触底回调</h2>`,3),H=n("strong",null,"触底回调",-1),k=l(`<p>由于代码比较复杂，只提取关键信息作为<strong>逻辑代码</strong>示例：</p><div class="language-ahk line-numbers-mode" data-ext="ahk"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">; 异步加载列表 即toBottomHandler参数填入的函数</span></span>
<span class="line"><span style="color:#61AFEF;">asyncLoading</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; totalNum, offset是储存在that.pluginOtherData中的其他数据</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">; this.pageSize属于闭包的访问到this，即文件搜索插件类，pageSize代表一次加载多少项</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginOtherData</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">totalNum</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginOtherData</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">offset</span><span style="color:#ABB2BF;"> + </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pageSize</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 如果未加载完成</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 设置Everything搜索条件偏移量</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginOtherData</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">offset</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">+=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pageSize</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Everything</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setOffset</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pluginOtherData</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">offset</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">; 进行搜索</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Everything</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">query</span><span style="color:#ABB2BF;">()) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">;...</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 将搜索结果添加到 pluginSearchResult 中</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">;...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Opt</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-Redraw&quot;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;">;禁用重绘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 将结果添加到listView中，包括了图标资源的动态加载</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addItemsToLV</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">that</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">tempList</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">; 此处不使用resizeGui()是因为在搜索处理函数中一定调用了，应当避免重复调用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">that</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listView</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">Opt</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Redraw&quot;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;">;启用重绘</span></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">else</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">PluginHelper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Utils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">tip</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;Everything搜索失败, 错误码:&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Everything</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLastError</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2);function q(w,T){const p=t("RouterLink"),e=t("ExternalLinkIcon");return c(),r("div",null,[d,n("p",null,[s("在此，以"),a(p,{to:"/plugin/web-search.html"},{default:o(()=>[s("网页搜索")]),_:1}),s("插件源码中的"),A,s("为例子，稍作修改并添加注释：")]),v,n("p",null,[u,s(" 是 "),E,s(" 对象，用于存储"),C,s("到"),n("a",m,[s("ImageList"),a(e)]),s("中图标序号的映射关系，方便添加图标到"),h,s("中。")]),b,n("p",null,[s("当前 "),g,s(" 绑定的 "),f,s(" 的id，一般用于添加图标到 "),D,s(" 中，即"),n("a",_,[s("IL_Add()"),a(e)])]),x,n("p",null,[s("接下来我们升级一下基础篇的"),a(p,{to:"/dev/plugin-mode/basics.html#%E7%AE%80%E6%98%93%E6%96%87%E4%BB%B6%E5%A4%B9%E7%A4%BA%E4%BE%8B"},{default:o(()=>[s("简易文件夹示例")]),_:1}),s("，让这个示例的列表同时支持图标。")]),I,n("p",null,[s("请细看API文档"),a(p,{to:"/api/showPluginMode.html"},{default:o(()=>[s("showPluginMode")]),_:1}),s("中 "),L,s(", "),P,s(" 的相关解释，在此仅仅给两个代码片段，作为参考")]),S,n("p",null,[s("在"),a(p,{to:"/plugin/file-find.html"},{default:o(()=>[s("文件搜索")]),_:1}),s("插件中就使用了"),H,s("，实现异步加载数据，而不是直接加载全部数据。")]),k])}const R=B(F,[["render",q],["__file","advanced.html.vue"]]);export{R as default};
